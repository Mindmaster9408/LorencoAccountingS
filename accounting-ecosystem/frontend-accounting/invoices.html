<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lorenco Accounting - Invoices</title>
    <script src="js/navigation.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f8f9fa;
        }
        
        .top-bar {
            background: linear-gradient(135deg, #0066cc 0%, #0099ff 100%);
            color: white;
            padding: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
            box-shadow: 0 2px 8px rgba(0,102,204,0.2);
        }
        
        .brand-section {
            display: flex;
            align-items: center;
            height: 100%;
            gap: 20px;
            padding: 0 25px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 20px;
            letter-spacing: -0.5px;
        }
        
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #ffffff 0%, #e6f3ff 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #0066cc;
            font-size: 18px;
        }
        
        .company-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(255,255,255,0.15);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }
        
        .company-selector:hover {
            background: rgba(255,255,255,0.25);
        }
        
        .right-section {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 0 25px;
        }
        
        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.15);
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            color: white;
            font-size: 16px;
        }
        
        .icon-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-1px);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: rgba(255,255,255,0.15);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .user-menu:hover {
            background: rgba(255,255,255,0.25);
        }
        
        .user-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffffff 0%, #e6f3ff 100%);
            color: #0066cc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
        }
        
        .user-name {
            font-size: 13px;
            font-weight: 500;
        }
        
        .navbar {
            background: white;
            border-bottom: 1px solid #e8eaed;
            display: flex;
            align-items: center;
            padding: 0 25px;
            height: 56px;
            gap: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }
        
        .nav-item {
            position: relative;
            height: 100%;
            display: flex;
            align-items: center;
        }
        
        .nav-link {
            height: 100%;
            display: flex;
            align-items: center;
            padding: 0 16px;
            color: #333;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .nav-link:hover {
            color: #0066cc;
            background: rgba(0,102,204,0.05);
            border-bottom-color: #0066cc;
        }
        
        .nav-item.active .nav-link {
            color: #0066cc;
            border-bottom-color: #0066cc;
            background: rgba(0,102,204,0.05);
        }
        
        .dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #e8eaed;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s;
            z-index: 1000;
            margin-top: 4px;
        }
        
        .nav-item:hover .dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-header {
            padding: 10px 16px;
            font-size: 11px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid #e8eaed;
            background: #f8f9fa;
        }
        
        .dropdown a {
            display: block;
            padding: 10px 16px;
            color: #333;
            text-decoration: none;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .dropdown a:hover {
            background: rgba(0,102,204,0.08);
            color: #0066cc;
            padding-left: 20px;
        }
        
        .dropdown a:first-child {
            border-radius: 8px 8px 0 0;
        }
        
        .dropdown a:last-child {
            border-radius: 0 0 8px 8px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #1a1a1a;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0066cc 0%, #0099ff 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,102,204,0.3);
        }
        
        .btn-secondary {
            background: white;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .btn-secondary:hover {
            background: #f8f9fa;
            border-color: #0066cc;
            color: #0066cc;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .card-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e8eaed;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .filters {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .search-box {
            position: relative;
            width: 250px;
        }
        
        .search-box input {
            width: 100%;
            padding: 8px 16px 8px 40px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0,102,204,0.1);
        }
        
        .search-box::before {
            content: 'üîç';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
        }
        
        select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #f8f9fa;
            border-bottom: 2px solid #e8eaed;
        }
        
        th {
            padding: 14px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            padding: 16px;
            border-bottom: 1px solid #e8eaed;
            font-size: 14px;
            color: #333;
        }
        
        tbody tr {
            transition: all 0.2s;
        }
        
        tbody tr:hover {
            background: rgba(0,102,204,0.04);
        }
        
        .invoice-number {
            font-weight: 600;
            color: #0066cc;
            cursor: pointer;
        }
        
        .invoice-number:hover {
            text-decoration: underline;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .badge-paid {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-unpaid {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-overdue {
            background: #f8d7da;
            color: #721c24;
        }
        
        .badge-draft {
            background: #e2e3e5;
            color: #383d41;
        }
        
        .actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: #f8f9fa;
            border-color: #0066cc;
            color: #0066cc;
        }
        
        .tabs {
            display: flex;
            gap: 4px;
            padding: 0 25px;
            background: white;
            border-bottom: 1px solid #e8eaed;
        }
        
        .tab {
            padding: 12px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .tab:hover {
            color: #0066cc;
            background: rgba(0,102,204,0.05);
        }
        
        .tab.active {
            color: #0066cc;
            border-bottom-color: #0066cc;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e8eaed;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .close-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            font-size: 20px;
            color: #666;
            transition: all 0.2s;
        }
        
        .close-btn:hover {
            background: #e8eaed;
            color: #333;
        }
        
        .modal-body {
            padding: 25px;
            overflow-y: auto;
        }
        
        .invoice-form {
            display: grid;
            gap: 25px;
        }
        
        .form-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            font-size: 13px;
            font-weight: 500;
            color: #333;
        }
        
        input, select, textarea {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0,102,204,0.1);
        }
        
        .line-items {
            margin-top: 20px;
        }
        
        .line-items-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .line-items-table {
            width: 100%;
            margin-bottom: 15px;
        }
        
        .line-items-table th {
            background: #f8f9fa;
            padding: 10px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }
        
        .line-items-table td {
            padding: 10px;
            border-bottom: 1px solid #e8eaed;
        }
        
        .line-items-table input {
            width: 100%;
        }
        
        .remove-line {
            color: #dc3545;
            cursor: pointer;
            font-size: 18px;
        }
        
        .totals-section {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .totals {
            width: 300px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
        }
        
        .total-row.grand-total {
            border-top: 2px solid #0066cc;
            margin-top: 8px;
            padding-top: 12px;
            font-weight: 700;
            font-size: 16px;
            color: #0066cc;
        }
        
        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #e8eaed;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
    </style>
    <link rel="stylesheet" href="css/dark-theme.css">
</head>
<body>

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Sales Invoices</h1>
            <div class="header-actions">
                <button class="btn btn-secondary">
                    <span>üìä</span>
                    Export
                </button>
                <button class="btn btn-primary" onclick="openNewInvoice()">
                    <span>+</span>
                    New Invoice
                </button>
            </div>
        </div>

        <div class="card">
            <div class="tabs">
                <button class="tab active" onclick="switchMainTab(event, 'all')">All Invoices</button>
                <button class="tab" onclick="switchMainTab(event, 'unpaid')">Unpaid</button>
                <button class="tab" onclick="switchMainTab(event, 'overdue')">Overdue</button>
                <button class="tab" onclick="switchMainTab(event, 'draft')">Drafts</button>
            </div>
            <div class="card-header">
                <div class="filters">
                    <div class="search-box">
                        <input type="text" placeholder="Search invoices..." oninput="filterInvoices(this.value)">
                    </div>
                    <select onchange="filterByCustomer(this.value)">
                        <option value="">All Customers</option>
                        <option value="ABC Corporation">ABC Corporation</option>
                        <option value="XYZ Enterprises">XYZ Enterprises</option>
                        <option value="Tech Solutions Ltd">Tech Solutions Ltd</option>
                    </select>
                </div>
            </div>
            <div class="table-container">
                <table id="invoiceTable">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Customer</th>
                            <th>Date</th>
                            <th>Due Date</th>
                            <th>Amount</th>
                            <th>Paid</th>
                            <th>Balance</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="invoiceTableBody">
                        <!-- Invoices will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- New/Edit Invoice Modal -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">New Invoice</h2>
                <button class="close-btn" onclick="closeInvoiceModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form class="invoice-form">
                    <div class="form-section">
                        <div class="form-group">
                            <label>Customer *</label>
                            <select id="customerId" required>
                                <option value="">Select Customer</option>
                                <option value="1">ABC Corporation</option>
                                <option value="2">XYZ Enterprises</option>
                                <option value="3">Tech Solutions Ltd</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Invoice Number *</label>
                            <input type="text" id="invoiceNumber" required>
                        </div>
                        <div class="form-group">
                            <label>Invoice Date *</label>
                            <input type="date" id="invoiceDate" required>
                        </div>
                        <div class="form-group">
                            <label>Due Date *</label>
                            <input type="date" id="dueDate" required>
                        </div>
                        <div class="form-group full-width">
                            <label>Reference</label>
                            <input type="text" id="reference">
                        </div>
                        <div class="form-group full-width">
                            <label>Notes</label>
                            <textarea id="notes" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="line-items">
                        <div class="line-items-header">
                            <h3>Line Items</h3>
                            <button type="button" class="btn btn-secondary" onclick="addLineItem()">
                                <span>+</span> Add Line
                            </button>
                        </div>
                        <table class="line-items-table">
                            <thead>
                                <tr>
                                    <th style="width: 40%;">Description</th>
                                    <th style="width: 15%;">Quantity</th>
                                    <th style="width: 15%;">Unit Price</th>
                                    <th style="width: 15%;">VAT %</th>
                                    <th style="width: 10%;">Total</th>
                                    <th style="width: 5%;"></th>
                                </tr>
                            </thead>
                            <tbody id="lineItemsBody">
                                <!-- Line items will be added here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="totals-section">
                        <div class="totals">
                            <div class="total-row">
                                <span>Subtotal:</span>
                                <span id="subtotal">R 0.00</span>
                            </div>
                            <div class="total-row">
                                <span>VAT:</span>
                                <span id="vatAmount">R 0.00</span>
                            </div>
                            <div class="total-row grand-total">
                                <span>Total:</span>
                                <span id="grandTotal">R 0.00</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeInvoiceModal()">Cancel</button>
                <button class="btn btn-secondary" onclick="saveDraft()">Save as Draft</button>
                <button class="btn btn-primary" onclick="saveInvoice()">Create Invoice</button>
            </div>
        </div>
    </div>

    <script>
        // Sample invoice data
        let invoices = [
            {
                id: 1,
                number: 'INV-2024-001',
                customer: 'ABC Corporation',
                customerId: 1,
                date: '2024-01-15',
                dueDate: '2024-02-14',
                amount: 15750.00,
                paid: 0,
                status: 'Unpaid'
            },
            {
                id: 2,
                number: 'INV-2024-002',
                customer: 'XYZ Enterprises',
                customerId: 2,
                date: '2024-01-20',
                dueDate: '2024-02-19',
                amount: 8420.50,
                paid: 0,
                status: 'Unpaid'
            },
            {
                id: 3,
                number: 'INV-2024-003',
                customer: 'Tech Solutions Ltd',
                customerId: 3,
                date: '2024-01-05',
                dueDate: '2024-02-04',
                amount: 25000.00,
                paid: 25000.00,
                status: 'Paid'
            },
            {
                id: 4,
                number: 'INV-2023-045',
                customer: 'ABC Corporation',
                customerId: 1,
                date: '2023-12-15',
                dueDate: '2024-01-14',
                amount: 12500.00,
                paid: 5000.00,
                status: 'Overdue'
            }
        ];

        let currentFilter = 'all';
        let lineItemCounter = 0;

        // Load invoices on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadInvoices();
            addLineItem(); // Add first line item
            
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 30);
            document.getElementById('invoiceDate').value = today;
            document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
            
            // Generate invoice number
            const nextNumber = (invoices.length + 1).toString().padStart(3, '0');
            document.getElementById('invoiceNumber').value = `INV-2024-${nextNumber}`;
        });

        function loadInvoices(filter = 'all') {
            currentFilter = filter;
            const tbody = document.getElementById('invoiceTableBody');
            tbody.innerHTML = '';

            let filteredInvoices = invoices;
            if (filter === 'unpaid') {
                filteredInvoices = invoices.filter(inv => inv.status === 'Unpaid');
            } else if (filter === 'overdue') {
                filteredInvoices = invoices.filter(inv => inv.status === 'Overdue');
            } else if (filter === 'draft') {
                filteredInvoices = invoices.filter(inv => inv.status === 'Draft');
            }

            filteredInvoices.forEach(invoice => {
                const balance = invoice.amount - invoice.paid;
                const statusClass = invoice.status.toLowerCase().replace(' ', '-');
                
                const row = `
                    <tr>
                        <td><span class="invoice-number" onclick="viewInvoice(${invoice.id})">${invoice.number}</span></td>
                        <td>${invoice.customer}</td>
                        <td>${new Date(invoice.date).toLocaleDateString()}</td>
                        <td>${new Date(invoice.dueDate).toLocaleDateString()}</td>
                        <td>R ${invoice.amount.toFixed(2)}</td>
                        <td>R ${invoice.paid.toFixed(2)}</td>
                        <td>R ${balance.toFixed(2)}</td>
                        <td><span class="badge badge-${statusClass}">${invoice.status}</span></td>
                        <td>
                            <div class="actions">
                                <button class="action-btn" onclick="viewInvoice(${invoice.id})">View</button>
                                <button class="action-btn" onclick="emailInvoice(${invoice.id})">Email</button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function switchMainTab(event, filter) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            loadInvoices(filter);
        }

        function filterInvoices(search) {
            const tbody = document.getElementById('invoiceTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search.toLowerCase()) ? '' : 'none';
            }
        }

        function filterByCustomer(customer) {
            const tbody = document.getElementById('invoiceTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let row of rows) {
                if (!customer) {
                    row.style.display = '';
                } else {
                    const text = row.textContent;
                    row.style.display = text.includes(customer) ? '' : 'none';
                }
            }
        }

        function openNewInvoice() {
            document.getElementById('modalTitle').textContent = 'New Invoice';
            document.getElementById('invoiceModal').classList.add('active');
        }

        function closeInvoiceModal() {
            document.getElementById('invoiceModal').classList.remove('active');
        }

        function addLineItem() {
            lineItemCounter++;
            const tbody = document.getElementById('lineItemsBody');
            const row = document.createElement('tr');
            row.id = `line-${lineItemCounter}`;
            row.innerHTML = `
                <td><input type="text" placeholder="Description" onchange="calculateTotals()"></td>
                <td><input type="number" value="1" min="0" step="1" onchange="calculateLineTotal(${lineItemCounter})"></td>
                <td><input type="number" value="0" min="0" step="0.01" onchange="calculateLineTotal(${lineItemCounter})"></td>
                <td>
                    <select onchange="calculateLineTotal(${lineItemCounter})">
                        <option value="0">0%</option>
                        <option value="15" selected>15%</option>
                    </select>
                </td>
                <td><input type="text" readonly value="R 0.00" id="total-${lineItemCounter}"></td>
                <td><span class="remove-line" onclick="removeLineItem(${lineItemCounter})">√ó</span></td>
            `;
            tbody.appendChild(row);
        }

        function removeLineItem(id) {
            document.getElementById(`line-${id}`).remove();
            calculateTotals();
        }

        function calculateLineTotal(id) {
            const row = document.getElementById(`line-${id}`);
            const inputs = row.getElementsByTagName('input');
            const select = row.getElementsByTagName('select')[0];
            
            const qty = parseFloat(inputs[1].value) || 0;
            const price = parseFloat(inputs[2].value) || 0;
            const vatRate = parseFloat(select.value) || 0;
            
            const subtotal = qty * price;
            const vat = subtotal * (vatRate / 100);
            const total = subtotal + vat;
            
            document.getElementById(`total-${id}`).value = `R ${total.toFixed(2)}`;
            calculateTotals();
        }

        function calculateTotals() {
            let subtotal = 0;
            let vatAmount = 0;
            
            const rows = document.getElementById('lineItemsBody').getElementsByTagName('tr');
            for (let row of rows) {
                const inputs = row.getElementsByTagName('input');
                const select = row.getElementsByTagName('select')[0];
                
                const qty = parseFloat(inputs[1].value) || 0;
                const price = parseFloat(inputs[2].value) || 0;
                const vatRate = parseFloat(select.value) || 0;
                
                const lineSubtotal = qty * price;
                const lineVat = lineSubtotal * (vatRate / 100);
                
                subtotal += lineSubtotal;
                vatAmount += lineVat;
            }
            
            const total = subtotal + vatAmount;
            
            document.getElementById('subtotal').textContent = `R ${subtotal.toFixed(2)}`;
            document.getElementById('vatAmount').textContent = `R ${vatAmount.toFixed(2)}`;
            document.getElementById('grandTotal').textContent = `R ${total.toFixed(2)}`;
        }

        function saveInvoice() {
            const customer = document.getElementById('customerId').value;
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            
            if (!customer || !invoiceNumber) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Get total from display
            const totalText = document.getElementById('grandTotal').textContent;
            const amount = parseFloat(totalText.replace('R ', '').replace(',', ''));
            
            const invoice = {
                id: invoices.length + 1,
                number: invoiceNumber,
                customer: document.getElementById('customerId').selectedOptions[0].text,
                customerId: parseInt(customer),
                date: document.getElementById('invoiceDate').value,
                dueDate: document.getElementById('dueDate').value,
                amount: amount,
                paid: 0,
                status: 'Unpaid'
            };
            
            invoices.push(invoice);
            loadInvoices(currentFilter);
            closeInvoiceModal();
            
            alert('Invoice created successfully!');
        }

        function saveDraft() {
            alert('Saved as draft');
            closeInvoiceModal();
        }

        function viewInvoice(id) {
            alert('View invoice: ' + id);
        }

        function emailInvoice(id) {
            alert('Email invoice: ' + id);
        }
    </script>
</body>
</html>
